<!DOCTYPE html>
<html lang="en-us">
<head>
    <meta charset="utf-8" />
    <meta name="description" 
    content="tyrad的个人技术博客，主要关注移动互联网,iOS,Flutter,Java,H5,Linux等技术。"> 
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="google-site-verification" content="4GHpSI8Or6aARE0YwdGyiIPg2Xpo01z1VvqQu9o2n1M" />
    <title>Yii学习笔记(一) |  QuickTouch</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    
    <link rel="stylesheet" href="https://quicktouch.github.io/css/font-awesome.min.css" />
    <link rel="stylesheet" href="https://quicktouch.github.io/css/spectre-exp.min.css" />
    <link rel="stylesheet" href="https://quicktouch.github.io/css/spectre-icons.css" />
    <link rel="stylesheet" href="https://quicktouch.github.io/css/spectre.min.css" />
    <link rel="stylesheet" href="https://quicktouch.github.io/css/theme.min.css" />
    <link rel="stylesheet" href="https://quicktouch.github.io/css/blog.css" />
    <link rel="stylesheet" href="https://quicktouch.github.io/css/override.css" /></head>

<body id="top"
    class="header-fixed header-animated sticky-footer ">
    <div id="page-wrapper">
        <section id="header" class="section">
            <section class="container grid-lg">
                <nav class="navbar">
                    <section class="navbar-section logo">
                        <a href="https://quicktouch.github.io" class="navbar-brand mr-10">
    
    

    <svg height="146px" viewBox="0 0 452 146" version="1.1" xmlns="http://www.w3.org/2000/svg"
        xmlns:xlink="http://www.w3.org/1999/xlink">
        <g id="页面1" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">
            <g id="black-37249" transform="translate(1.493827, 14.000000)" fill="#000000" fill-rule="nonzero">
                <path
                    d="M49.1575565,105.3356 C58.6514419,107.744266 56.8866035,117.059598 47.336582,117.946151 C42.200257,119.088059 32.5122345,116.823453 40.3049269,121.756528 C38.9160522,122.059136 31.4488504,121.215252 34.0530212,124.835545 C49.3931802,133.332539 76.1538235,115.03264 58.9252282,100.789887 C52.729951,96.9744155 44.6696275,99.6170026 49.1574334,105.335227 L49.1575565,105.3356 Z"
                    id="路径"></path>
                <path
                    d="M19.6456893,70.1148 C22.442564,67.6540154 27.5058454,64.8429245 31.2812983,65.0068451 C34.6705665,65.8322497 35.5828047,67.0095653 39.186732,72.7438254 C42.8052895,78.5014146 47.9529463,97.2035504 46.1250646,102.790183 C44.2922642,108.392369 38.9206152,112.836988 32.033488,115.798916 C26.5426541,118.077388 16.2140442,117.216187 11.6635736,112.33745 C7.2203064,106.943992 10.4439768,99.2077518 14.1196674,94.0765913 C17.8286541,88.8988961 15.684207,74.5702816 19.6458155,70.1143062 L19.6456893,70.1148 Z"
                    id="路径"></path>
                <path
                    d="M1.04535518,39.6272974 C4.05921119,39.3911165 4.59137567,39.1071824 5.59060008,38.0238167 C6.58982449,36.9404509 5.54928544,35.2576243 6.19663273,34.5114663 C6.84398002,33.7653083 8.10097246,32.9215361 9.07530028,33.5952113 C10.0496281,34.2688865 10.1138613,37.3267543 9.37831661,38.4819379 C8.64277193,39.6371215 5.43905457,40.0090086 5.43905457,40.0090086 L-0.469776243,41.8414683 C-1.16205066,72.2197737 13.1673278,72.6175072 32.5592772,62.9150689 C34.2888429,65.128073 36.8652659,66.7978007 39.3430985,68.5308898 C41.0289707,68.9713953 42.7656319,69.3673848 46.0436407,68.4125409 C52.7893702,66.6134557 67.7858277,37.9865577 58.6189054,24.5853236 C59.5609921,22.3072017 58.5329188,17.6980103 54.831139,9.92564579 C51.5837531,14.9810013 48.3835461,17.0014121 44.9911376,18.7424057 C39.7628549,17.4246155 36.1260864,16.8411895 31.0440711,17.2556102 C32.114064,10.6923806 28.9520111,5.60816741 24.8321244,0 C14.7334474,6.21819269 9.90786696,14.7224118 6.65139374,20.7687134 C4.38306595,26.7113784 -1.96157957,39.8636841 1.04555436,39.6278043 L1.04535518,39.6272974 Z"
                    id="路径"></path>
            </g>
            <text id="TYRAD" font-family="STBaoliSC-Regular, Baoli SC" font-size="116" font-weight="normal"
                fill="#000000">
                <tspan x="87" y="106">TYRAD</tspan>
            </text>
        </g>
    </svg>

    
    

    
</a>
                    </section>
                    <section class="navbar-section desktop-menu">
                        <nav class="dropmenu animated">

<ul class=""><li>
        <a href="/" title="Home page"
            class="">Home</a>
    </li><li>
        <a href="/archives/" title="Archives page"
            class="">Archives</a>
    </li><li>
        <a href="/wiki/" title="Wiki page"
            class="">Wiki</a>
    </li><li>
        <a href="/tools/" title="Tools page"
            class="">Tools</a>
        <ul><li>
                <a href="/tools/json/" class="">JSON解析</a>
            </li><li>
                <a href="/tools/rsa/" class="">RSA测试</a>
            </li><li>
                <a href="/tools/knowlegenav/" class="">导航</a>
            </li></ul>
    </li><li>
        <a href="/about/" title="About page"
            class="">About</a>
    </li></ul></nav>
                    </section>
                </nav>
            </section>
        </section>
        <div class="mobile-menu">
            <div class="button_container" id="toggle">
                <span class="top"></span>
                <span class="middle"></span>
                <span class="bottom"></span>
            </div>
        </div>

<section id="blog-hero" class="section 
modular-hero hero text-dark title-h1h2 overlay-dark-gradient hero-tiny parallax"
    style="padding-top: 4rem;padding-bottom: 0;">
    <section class="container grid-lg" style="text-align: center">
        <h2> Yii学习笔记(一) </h2>
        <h2 style="margin-top: 1rem;"></h2>
        

<span class="breadcrumbs" style="padding-right:40px;">
    <i class="fa fa-bookmark" aria-hidden="true"></i>
    
    
    
    
    
    
    
    
    <span><a href='https://quicktouch.github.io/wiki'>wiki</a></span> &nbsp/&nbsp
    
    
    
    
    
    
    <span><a href='https://quicktouch.github.io/wiki#php'>php</a></span>
    
    
    
    
    
    
    
    
    
</span>

        <span class="blog-date">
            <time class="dt-published" datetime='2017-09-07T20:46:52.000&#43;00:00'
                itemprop="datePublished">
                <i class="fa fa-calendar"></i> 2017-09-07
            </time>
        </span>
        <span class="tags">
            
        </span>
    </section>
</section>
<section id="start">
    <section id="body-wrapper" class="section blog-listing post-content">
        <section class="container grid-lg">
            <div class="columns">
                <div id="item"
                    class="column  col-10  col-md-12 extra-spacing blog-content">

<blockquote>
<p>来自<a href="http://www.imooc.com/learn/404">与《Yii框架》不得不说的故事—基础篇</a></p>
</blockquote>

<h2 id="配置">配置</h2>

<p>入口脚本文件: <code>config/web.php</code></p>

<ul>
<li><code>cookieValidationKey</code>是为了防止cookie攻击的</li>
</ul>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-PHP" data-lang="PHP">$config = [
    &#39;id&#39; =&gt; &#39;basic&#39;,
    &#39;basePath&#39; =&gt; dirname(__DIR__),
    &#39;bootstrap&#39; =&gt; [&#39;log&#39;],
    &#39;components&#39; =&gt; [
        &#39;request&#39; =&gt; [
            //用来防止cook攻击的
            // !!! insert a secret key in the following (if it is empty) - this is required by cookie validation
            &#39;cookieValidationKey&#39; =&gt; &#39;_FEdiSEYNINKhO2Pt8JCp33PkGvB4wBj&#39;,
        ],
        ....</code></pre></div>
<h2 id="请求处理流程">请求处理流程</h2>

<p><img src="http://image.tyrad.cc/2017090722293application-structure.png" alt="2017090722293application-structure.png" /></p>

<p>(图片来自:<a href="http://www.yiichina.com/doc/guide/2.0/structure-overview">http://www.yiichina.com/doc/guide/2.0/structure-overview</a>)</p>

<p>请求交给了应用主体 -&gt; 应用主体处理请求之前会加载应用组件、以及相应的模块来更好的处理请求 -&gt; 正式处理请求时会把请求的数据委托给控制器 -&gt; 控制器通过<code>模型</code>来和数据库打交道 -&gt; 需要展示的话会让视图去进行相应操作</p>

<h2 id="控制器controller创建">控制器Controller创建</h2>

<h3 id="创建">创建</h3>

<p>新建一个<code>HelloController.php</code>,放到controller目录下。</p>

<ol>
<li>需要使用命名空间<code>namespace app\controllers;</code></li>
<li>需要继承自<code>Controller</code>,因此需要<code>use yii\web\Controller;</code></li>
<li>不需要<code>include</code>也可以使用外部对象,因为<code>composer</code>帮我们做了这一操作,具体见<code>composer.json</code>的配置</li>
</ol>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-PHP" data-lang="PHP"><span style="color:#633820">&lt;?php</span>
<span style="color:#a90d91">namespace</span> <span style="color:#000">app\controllers</span>; <span style="color:#177500">//必须使用命名空间app\controller
</span><span style="color:#177500"></span><span style="color:#a90d91">use</span> <span style="color:#000">yii\web\Controller</span>; <span style="color:#177500">//xxController继承于`controller`
</span><span style="color:#177500"></span><span style="color:#a90d91">class</span> <span style="color:#3f6e75">HelloController</span> <span style="color:#a90d91">extends</span> <span style="color:#000">Controller</span>
{
    <span style="color:#177500">// http://localhost/Yii/basic/web/?r=hello/index
</span><span style="color:#177500"></span>    <span style="color:#a90d91">public</span> <span style="color:#a90d91">function</span> <span style="color:#000">actionIndex</span>(){
        <span style="color:#a90d91">echo</span> <span style="color:#c41a16">&#39;hello world&#39;</span>;
    }
}
</code></pre></div>
<p>访问<code>http://localhost/Yii/basic/web/?r=hello/index</code>或<code>http://localhost/Yii/basic/web/?r=hello</code>就可以看到&rsquo;hello world&rsquo;了。 (访问路径以自己实际配置的为准)</p>

<h3 id="获取请求参数等">获取请求参数等</h3>

<p>需要用到全局类<code>Yii</code>,<code>$app</code>为全局变量。可以使用`<code>use Yii;</code>或者<code>\Yii::$App</code></p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-PHP" data-lang="PHP">    public function actionIndex(){

        //请求组件:
        //Yii为全局类。 $app为全局变量  可以`use Yii;`或者 `\Yii:$app`
        //http://localhost/Yii/basic/web/?r=hello/index<span style="color:#000">&amp;</span>id=3
        //http://localhost/Yii/basic/web/?r=hello/index<span style="color:#000">&amp;</span>id=999
        //如何处理参数
        $request = Yii::$app -&gt; request;
        echo $request -&gt; get(&#39;id&#39;);
        //默认值为20,如果没有id参数的话
        echo $request -&gt; get(&#39;id&#39;,20);

        //类似的
        //post
        //$request -&gt; post(&#39;name&#39;,3333);

        //判断是get还是其他
        if ($request -&gt; isGet){
            echo &#39;&lt;<span style="color:#000">br</span>&gt;是get请求&#39;;
        }
        //获取ip地址
        echo $request -&gt; userIP;
    }</code></pre></div>
<h3 id="响应处理">响应处理</h3>

<h3 id="返回状态码">返回状态码:</h3>

<pre><code>public function actionIndex2(){
   //response组件
   $res = Yii::$app -&gt; response;
   //设置返回码,如返回404
   $res -&gt; statusCode = 404;
}
</code></pre>

<h3 id="可以设置响应头">可以设置响应头:</h3>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-PHP" data-lang="PHP">    public function actionIndex2(){
        //response组件
        $res = Yii::$app -&gt; response;
        $res -&gt; headers -&gt; add(&#39;pragma&#39;,&#39;no-cache&#39;);
//        $res -&gt; headers -&gt; set(&#39;pragma&#39;,&#39;max-age=5&#39;);
//        $res -&gt; headers -&gt; remove(&#39;pragma&#39;);
    }</code></pre></div>
<p><img src="http://image.tyrad.cc/201709123287011.png" alt="201709123287011.png" /></p>

<h3 id="重定向">重定向</h3>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-PHP" data-lang="PHP">   public function actionIndex2(){
        //response组件
        $res = Yii::$app -&gt; response;
          //$res -&gt; headers -&gt; add(&#39;Location&#39;,&#39;http://www.baidu.com&#39;);
         //yi controller 封装了redirect方法
        //$this -&gt; redirect(&#39;https://baidu.com&#39;);
        $this -&gt; redirect(&#39;https://baidu.com&#39;,302);
    }</code></pre></div>
<h3 id="文件下载">文件下载</h3>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-PHP" data-lang="PHP">public function actionIndex2(){
        //response组件
        $res = Yii::$app -&gt; response;
        //文件下载
        //这样会下载一个 a.png的文件。 但是是空的，因为没有配置
        //$res -&gt; headers -&gt; add(&#39;content-disposition&#39;,&#39;attachment;filename=&#34;a.png&#34;&#39;);
        //yi controller 封装了方法 ,但是如果没有文件会抛出异常
        $res -&gt; sendFile(&#39;./b.jpg&#39;);
    }</code></pre></div>
<p><code>$res -&gt; sendFile('./b.jpg');</code>中,如果找不到路径下的文件就会抛出异常:</p>

<p><img src="http://image.tyrad.cc/2017091284652error.png" alt="2017091284652error.png" /></p>

<p>此处文件路径位置是相对于入口脚本(<code>web/index,php</code>)的路径.</p>

<h3 id="session">session</h3>

<p>需要用到<code>session</code>组件： <code>$session = Yii::$app-&gt;session</code>.</p>

<p>判断是否开启: <code>$session -&gt; isActive</code></p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-PHP" data-lang="PHP">    public  function  actionIndex3(){

        $session = Yii::$app -&gt; session;

        //打开
        $session -&gt; open();

        if ($session-&gt;isActive){
            echo &#39;isActive&#39;;
        }else{
            echo &#39;not Active&#39;;
        }

        //这样可以存放数据了
        //存放位置在php.ini中的session.save_path可以找到
        $session -&gt; set(&#39;user&#39;,&#39;张三&#39;);

        echo $session-&gt;get(&#39;user&#39;);

        //删除
        $session -&gt; remove(&#39;user&#39;);
        echo $session-&gt;get(&#39;user&#39;).&#39;&lt;/<span style="color:#000">br</span>&gt;&#39;;
        
        //其他操作,可以当成数组处理。原因是继承了ArrayAccess
        $session[&#39;user&#39;]  = &#39;小明&#39;;
        echo $session-&gt;get(&#39;user&#39;).&#39;&lt;/<span style="color:#000">br</span>&gt;&#39;;
        //删除
        unset($session[&#39;user&#39;]);
        echo $session-&gt;get(&#39;user&#39;).&#39;&lt;/<span style="color:#000">br</span>&gt;&#39;;
    }</code></pre></div>
<p>存储的sessionId可以在这里看到. 本地session目录下的文件也是根据sessionId的值存储的。</p>

<p><img src="http://image.tyrad.cc/sessionId.png" alt="" /></p>

<h3 id="cookie">cookie</h3>

<p><img src="http://image.tyrad.cc/2017091433783cookie.png" alt="2017091433783cookie.png" /></p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-PHP" data-lang="PHP">public function  actionIndex4(){
   $cookies = Yii::$app -&gt; response -&gt;cookies;
   //从浏览器可以看到，cookie的值是加密的
   $cookiesData = array(&#39;name&#39; =&gt; &#39;user&#39; , &#39;value&#39; =&gt; &#39;zhangsan3&#39;);
   $cookies -&gt; add( new Cookie($cookiesData));
   //删除某个cookie
   //$cookies -&gt; remove(&#39;user&#39;);
   //取某个cookie值
   echo $cookies -&gt; getValue(&#39;user&#39;);
}</code></pre></div>
<p>cookie如何加密,与<code>onfig/web.php</code>中的<code>cookieValidationKey</code>有关。</p>

<h2 id="视图的创建">视图的创建</h2>

<p>Yii允许把代码移动到view中来编写。</p>

<h3 id="renderpartial">renderPartial</h3>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-PHP" data-lang="PHP">//HelloController.php文件
.... 
function  actionIndex(){
   //actionIndex和视图index.php对应
   //视图的index.php需要放到`Views/Hello`目录下,目录名称与`Hello`Controller保持一致
   //显示哪个view文件
   return $this-&gt;renderPartial(&#39;index&#39;);
}
...</code></pre></div>
<h3 id="传递字典或数组参数">传递字典或数组参数</h3>

<p>HelloController.php文件:</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-PHP" data-lang="PHP">function  actionIndex(){
   $data = array();
   $data[&#39;view_hello_str&#39;] =  &#39;Hello God!&#39;;
   //数组元素的情况,如何读取
   $data[&#39;view_test_arr&#39;] =  array(1,2);
   //传参数
   return $this -&gt; renderPartial(&#39;index&#39;,$data);
   //也可以用render，这样话会保留网站的header footer ，而不是一个新界面
   //return $this -&gt;render(&#39;index&#39;,$data);
}</code></pre></div>
<p>对应的视图文件<code>views/Hello/index.php</code>:</p>

<pre><code>&lt;?php
echo $view_hello_str; //浏览器会显示`Hello God`
echo  '&lt;/br&gt;';
echo $view_test_arr[0] ; //显示 `1`
</code></pre>

<h3 id="视图的数组安全">视图的数组安全</h3>

<p>举例:</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-PHP" data-lang="PHP">    function  actionIndex(){
        $data = array();
        $data[&#39;view_hello_str&#39;] =  &#39;Hello God! &lt;<span style="color:#000">script</span>&gt; <span style="color:#000">alert</span>(<span style="color:#c41a16">&#34;hello world&#34;</span>) &lt;/<span style="color:#000">script</span>&gt;&#39;;
        return $this -&gt; renderPartial(&#39;index&#39;,$data);
    }</code></pre></div>
<p>这样会导致执行javascript代码,如果字符串是用户传过来的，可能会导致安全问题。</p>

<p>处理方法:</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-PHP" data-lang="PHP"><span style="color:#633820">&lt;?php</span>
<span style="color:#a90d91">use</span> <span style="color:#000">yii\helpers\Html</span>;
<span style="color:#a90d91">use</span> <span style="color:#000">yii\helpers\HtmlPurifier</span>;
<span style="color:#633820">?&gt;</span>
&lt;<span style="color:#000">h1</span>&gt; <span style="color:#633820">&lt;?</span><span style="color:#000">=</span><span style="color:#000">html</span><span style="color:#000">::</span><span style="color:#836c28">encode</span>(<span style="color:#000">$view_hello_str</span>)<span style="color:#633820">?&gt;</span>  &lt;/<span style="color:#000">h1</span>&gt; //会输出正常字符串:Hello God! &lt;<span style="color:#000">script</span>&gt; <span style="color:#000">alert</span>(<span style="color:#c41a16">&#34;hello world&#34;</span>) &lt;/<span style="color:#000">script</span>&gt;
&lt;<span style="color:#000">h1</span>&gt; <span style="color:#633820">&lt;?</span><span style="color:#000">=</span><span style="color:#000">HtmlPurifier</span><span style="color:#000">::</span><span style="color:#836c28">process</span>(<span style="color:#000">$view_hello_str</span>)<span style="color:#633820">?&gt;</span>  &lt;/<span style="color:#000">h1</span>&gt; //输出`Hello God!`
</code></pre></div>
<h3 id="布局文件">布局文件</h3>

<p>使用布局文件可以使我们少些很多重复代码。</p>

<p>需要用到<code>render</code>方法:
render做两件事：</p>

<ol>
<li>将about.php的内容放到<code>$content</code>文件中</li>
<li>render方法把布局文件显示出来,布局文件通过<code>public  $layout = 'common';</code>来指定</li>
</ol>

<p>默认布局文件位置:<code>views/layouts/main.php</code></p>

<p>创建一个布局文件: <code>view/layouts/common.php</code></p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-PHP" data-lang="PHP"><span style="color:#633820">&lt;!DOCTYPE html&gt;</span>
&lt;<span style="color:#000">html</span>&gt;
&lt;<span style="color:#000">head</span>&gt;
    &lt;<span style="color:#000">meta</span> <span style="color:#836c28">charset</span><span style="color:#000">=</span><span style="color:#c41a16">&#34;utf-8&#34;</span> /&gt;
    &lt;<span style="color:#000">title</span>&gt;&lt;/<span style="color:#000">title</span>&gt;
    &lt;<span style="color:#000">script</span> <span style="color:#836c28">src</span><span style="color:#000">=</span><span style="color:#c41a16">&#34;https://cdn.bootcss.com/react/15.4.2/react.min.js&#34;</span>&gt;&lt;/<span style="color:#000">script</span>&gt;
    &lt;<span style="color:#000">script</span> <span style="color:#836c28">src</span><span style="color:#000">=</span><span style="color:#c41a16">&#34;https://cdn.bootcss.com/react/15.4.2/react-dom.min.js&#34;</span>&gt;&lt;/<span style="color:#000">script</span>&gt;
    &lt;<span style="color:#000">script</span> <span style="color:#836c28">src</span><span style="color:#000">=</span><span style="color:#c41a16">&#34;https://cdn.bootcss.com/babel-standalone/6.22.1/babel.min.js&#34;</span>&gt;&lt;/<span style="color:#000">script</span>&gt;
&lt;/<span style="color:#000">head</span>&gt;
&lt;<span style="color:#000">body</span>&gt;
    <span style="color:#633820">&lt;?</span><span style="color:#000">=</span><span style="color:#000">$content</span>;<span style="color:#633820">?&gt;</span>
&lt;/<span style="color:#000">body</span>&gt;
&lt;/<span style="color:#000">html</span>&gt;
</code></pre></div>
<p>controller:</p>

<pre><code>...
public  $layout = 'common';
public function actionAbout()
{
   //render做两件事
   //1.将about.php的内容放到`$content`文件中
   //2.render方法把布局文件`common`显示出来,布局文件通过`public  $layout = 'common';`来指定
   return $this-&gt;render('about');
}
...
</code></pre>

<p>视图文件<code>view2/Hello/index.php</code>:</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-PHP" data-lang="PHP">&lt;<span style="color:#000">h2</span>&gt; about page&lt;/<span style="color:#000">h2</span>&gt;
&lt;<span style="color:#000">div</span> <span style="color:#836c28">id</span><span style="color:#000">=</span><span style="color:#c41a16">&#34;example&#34;</span>&gt;&lt;/<span style="color:#000">div</span>&gt;
&lt;<span style="color:#000">script</span> <span style="color:#836c28">type</span><span style="color:#000">=</span><span style="color:#c41a16">&#34;text/babel&#34;</span>&gt;
    <span style="color:#000">ReactDOM</span>.<span style="color:#000">render</span>(
        <span style="color:#000">&lt;</span><span style="color:#000">h1</span><span style="color:#000">&gt;</span><span style="color:#000">Hello</span>, <span style="color:#000">world</span><span style="color:#000">!&lt;</span><span style="color:#000">/h1&gt;,</span>
        <span style="color:#a90d91">document</span>.<span style="color:#000">getElementById</span>(<span style="color:#c41a16">&#39;example&#39;</span>)
    );
&lt;/<span style="color:#000">script</span>&gt;</code></pre></div>
<h3 id="视图中显示其他视图-视图组件">视图中显示其他视图（视图组件）</h3>

<p>以视图:<code>index.php</code>为例:</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-PHP" data-lang="PHP"><span style="color:#177500">&lt;!--引入其他视图--&gt;</span>
<span style="color:#633820">&lt;?php</span> <span style="color:#a90d91">echo</span> <span style="color:#000">$this</span> <span style="color:#000">-&gt;</span> <span style="color:#836c28">render</span>(<span style="color:#c41a16">&#39;about&#39;</span>); <span style="color:#633820">?&gt;</span>

<span style="color:#177500">&lt;!--传参数--&gt;</span>
<span style="color:#633820">&lt;?php</span> <span style="color:#a90d91">echo</span> <span style="color:#000">$this</span> <span style="color:#000">-&gt;</span> <span style="color:#836c28">render</span>(<span style="color:#c41a16">&#39;about&#39;</span>,<span style="color:#a90d91">array</span>(<span style="color:#c41a16">&#39;v_hello_str&#39;</span> <span style="color:#000">=&gt;</span> <span style="color:#c41a16">&#39;hello world&#39;</span>)); <span style="color:#633820">?&gt;</span>
</code></pre></div>
<p>view: <code>about.php</code></p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-PHP" data-lang="PHP">&lt;<span style="color:#000">h2</span>&gt; this is  about page&lt;/<span style="color:#000">h2</span>&gt;
<span style="color:#633820">&lt;?php</span>
<span style="color:#a90d91">if</span> (<span style="color:#000">isset</span>(<span style="color:#000">$v_hello_str</span>)){
    <span style="color:#a90d91">echo</span>  <span style="color:#000">$v_hello_str</span>;
}
<span style="color:#633820">?&gt;</span>
</code></pre></div>
<p>浏览器输出结果:</p>

<p><img src="http://image.tyrad.cc/2017091712648out.png" alt="2017091712648out.png" /></p>

<h3 id="视图之数据块">视图之数据块</h3>

<p>指的是<code>layout</code>使用<code>view</code>文件的代码块。</p>

<p><strong>举例:</strong></p>

<p>controller指定了布局文件为<code>common.php</code></p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-PHP" data-lang="PHP">...
public  $layout = &#39;common&#39;;
public function actionAbout()
{
   return $this-&gt;render(&#39;about&#39;);
}
...</code></pre></div>
<p><code>view/Hello/about.php</code>文件:</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-PHP" data-lang="PHP">&lt;<span style="color:#000">h1</span>&gt; this is about page&lt;/<span style="color:#000">h1</span>&gt;
<span style="color:#633820">&lt;?php</span> <span style="color:#000">$this</span> <span style="color:#000">-&gt;</span> <span style="color:#836c28">beginBlock</span>(<span style="color:#c41a16">&#39;block1&#39;</span>);<span style="color:#633820">?&gt;</span>
&lt;<span style="color:#000">h2</span>&gt; 这是被替换掉的部分&lt;/<span style="color:#000">h2</span>&gt;
<span style="color:#633820">&lt;?php</span> <span style="color:#000">$this</span> <span style="color:#000">-&gt;</span> <span style="color:#836c28">endBlock</span>(); <span style="color:#633820">?&gt;</span>
</code></pre></div>
<p>布局文件<code>common.php</code>,使用<code>&lt;?=$this-&gt;blocks['block1'];?&gt;</code>可以将视图文件的block部分替换掉。</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-HTML" data-lang="HTML"><span style="color:#633820">&lt;!DOCTYPE html&gt;</span>
&lt;<span style="color:#000">html</span>&gt;
&lt;<span style="color:#000">head</span>&gt;
    &lt;<span style="color:#000">meta</span> <span style="color:#836c28">charset</span><span style="color:#000">=</span><span style="color:#c41a16">&#34;utf-8&#34;</span> /&gt;
    &lt;<span style="color:#000">title</span>&gt;&lt;/<span style="color:#000">title</span>&gt;
&lt;/<span style="color:#000">head</span>&gt;
&lt;<span style="color:#000">body</span>&gt;
    <span style="color:#633820">&lt;?=$this-&gt;blocks[&#39;block1&#39;];?&gt;</span>
    <span style="color:#633820">&lt;?=$content;?&gt;</span>
&lt;/<span style="color:#000">body</span>&gt;
&lt;/<span style="color:#000">html</span>&gt;</code></pre></div>
<p><img src="http://image.tyrad.cc/20170918417351.png" alt="20170918417351.png" /></p>

<p>需要注意的是:</p>

<ol>
<li>如果布局文件没有指定<code>&lt;?=$this-&gt;blocks['block1'];?&gt;</code>,浏览器就不会显示block块里的内容；</li>
<li>同样的,如果view文件没有指定<code>beginBlock..</code>,浏览器就不会显示block块里的内容。</li>
</ol>

<p>布局文件可以通过<code>isset</code>判断是否view文件是否包含相应的代码块:</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-PHP" data-lang="PHP"><span style="color:#633820">&lt;!DOCTYPE html&gt;</span>
&lt;<span style="color:#000">html</span>&gt;
&lt;<span style="color:#000">head</span>&gt;
    &lt;<span style="color:#000">meta</span> <span style="color:#836c28">charset</span><span style="color:#000">=</span><span style="color:#c41a16">&#34;utf-8&#34;</span> /&gt;
    &lt;<span style="color:#000">title</span>&gt;&lt;/<span style="color:#000">title</span>&gt;
&lt;/<span style="color:#000">head</span>&gt;
&lt;<span style="color:#000">body</span>&gt;
    <span style="color:#633820">&lt;?php</span> <span style="color:#a90d91">if</span> (<span style="color:#000">isset</span>(<span style="color:#000">$this</span><span style="color:#000">-&gt;</span><span style="color:#836c28">blocks</span>[<span style="color:#c41a16">&#39;block1&#39;</span>]))<span style="color:#000">:</span><span style="color:#633820">?&gt;</span>
        <span style="color:#633820">&lt;?</span><span style="color:#000">=</span><span style="color:#000">$this</span><span style="color:#000">-&gt;</span><span style="color:#836c28">blocks</span>[<span style="color:#c41a16">&#39;block1&#39;</span>];<span style="color:#633820">?&gt;</span>
    <span style="color:#633820">&lt;?php</span> <span style="color:#a90d91">else</span><span style="color:#000">:</span><span style="color:#633820">?&gt;</span>
        &lt;<span style="color:#000">h1</span>&gt;没有block1代码块&lt;/<span style="color:#000">h1</span>&gt;
    <span style="color:#633820">&lt;?php</span> <span style="color:#a90d91">endif</span>;<span style="color:#633820">?&gt;</span>
    <span style="color:#633820">&lt;?</span><span style="color:#000">=</span><span style="color:#000">$content</span>;<span style="color:#633820">?&gt;</span>
&lt;/<span style="color:#000">body</span>&gt;
&lt;/<span style="color:#000">html</span>&gt;
</code></pre></div>
<h2 id="数据模型">数据模型</h2>

<h3 id="数据库配置">数据库配置</h3>

<p>创建数据库并插入一条数据:</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql"><span style="color:#000">mysql</span><span style="color:#000">&gt;</span> <span style="color:#a90d91">create</span> <span style="color:#a90d91">database</span> <span style="color:#000">yii</span>;
<span style="color:#000">Query</span> <span style="color:#000">OK</span>, <span style="color:#1c01ce">1</span> <span style="color:#a90d91">row</span> <span style="color:#000">affected</span> (<span style="color:#1c01ce">0</span>.<span style="color:#1c01ce">01</span> <span style="color:#000">sec</span>)
<span style="color:#000">mysql</span><span style="color:#000">&gt;</span> <span style="color:#000">use</span> <span style="color:#000">yii</span>;
<span style="color:#a90d91">Database</span> <span style="color:#000">changed</span>
<span style="color:#000">mysql</span><span style="color:#000">&gt;</span>  <span style="color:#a90d91">create</span> <span style="color:#a90d91">table</span> <span style="color:#000">test2</span> (
    <span style="color:#000">-&gt;</span> <span style="color:#000">id</span> <span style="color:#a90d91">int</span> <span style="color:#000">auto_increment</span> <span style="color:#a90d91">primary</span> <span style="color:#a90d91">key</span> ,
    <span style="color:#000">-&gt;</span>  <span style="color:#000">title</span> <span style="color:#a90d91">varchar</span>(<span style="color:#1c01ce">20</span>)
    <span style="color:#000">-&gt;</span> ) <span style="color:#000">CHARSET</span><span style="color:#000">=</span><span style="color:#000">utf8</span>;
    
<span style="color:#000">mysql</span><span style="color:#000">&gt;</span> <span style="color:#a90d91">insert</span> <span style="color:#a90d91">into</span> <span style="color:#000">test2</span>(<span style="color:#000">title</span>) <span style="color:#a90d91">values</span>(<span style="color:#c41a16">&#39;小明&#39;</span>);
<span style="color:#000">Query</span> <span style="color:#000">OK</span>, <span style="color:#1c01ce">1</span> <span style="color:#a90d91">row</span> <span style="color:#000">affected</span> (<span style="color:#1c01ce">0</span>.<span style="color:#1c01ce">00</span> <span style="color:#000">sec</span>)</code></pre></div>
<p>数据库配置文件为<code>config/db.php</code>:</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-PHP" data-lang="PHP"><span style="color:#633820">&lt;?php</span>

<span style="color:#a90d91">return</span> [
    <span style="color:#c41a16">&#39;class&#39;</span> <span style="color:#000">=&gt;</span> <span style="color:#c41a16">&#39;yii\db\Connection&#39;</span>,
    <span style="color:#c41a16">&#39;dsn&#39;</span> <span style="color:#000">=&gt;</span> <span style="color:#c41a16">&#39;mysql:host=127.0.0.1;dbname=yii&#39;</span>,
    <span style="color:#c41a16">&#39;username&#39;</span> <span style="color:#000">=&gt;</span> <span style="color:#c41a16">&#39;root&#39;</span>,
    <span style="color:#c41a16">&#39;password&#39;</span> <span style="color:#000">=&gt;</span> <span style="color:#c41a16">&#39;123&#39;</span>,
    <span style="color:#c41a16">&#39;charset&#39;</span> <span style="color:#000">=&gt;</span> <span style="color:#c41a16">&#39;utf8&#39;</span>,
];
</code></pre></div>
<h3 id="数据模型之活动记录的创建">数据模型之活动记录的创建</h3>

<p>新建<code>models/test2.php</code>文件,与数据库表名相对应。</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-PHP" data-lang="PHP"><span style="color:#633820">&lt;?php</span>
<span style="color:#a90d91">namespace</span> <span style="color:#000">app\models</span>;
<span style="color:#a90d91">use</span> <span style="color:#000">yii\db\ActiveRecord</span>;

<span style="color:#177500">//继承于`ActiveRecord`
</span><span style="color:#177500"></span><span style="color:#a90d91">class</span> <span style="color:#3f6e75">Test2</span> <span style="color:#a90d91">extends</span> <span style="color:#000">ActiveRecord</span>
{
    <span style="color:#177500">//如果要修改表名,重写这个方法
</span><span style="color:#177500"></span>    <span style="color:#a90d91">public</span> <span style="color:#a90d91">static</span> <span style="color:#a90d91">function</span> <span style="color:#000">tableName</span>()
    {
        <span style="color:#a90d91">return</span> <span style="color:#a90d91">parent</span><span style="color:#000">::</span><span style="color:#836c28">tableName</span>(); <span style="color:#177500">// TODO: Change the autogenerated stub
</span><span style="color:#177500"></span>    }
}
</code></pre></div>
<p>操作数据库表:</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-PHP" data-lang="PHP">...
use app\models\Test2;
...
class HelloController extends Controller
{

    public function  actionIndex(){

        $sql = &#39;select * from test2 where id = 1 <span style="color:#000">&amp;&amp;</span> 1=1&#39;;
        $result =  Test2::findBySql($sql) -&gt; all();
        print_r($result);
    }
}</code></pre></div>
<h3 id="防止sql注入">防止sql注入</h3>

<p>如果用字符串拼接sql,可能会有问题,例如:</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql"><span style="color:#000">$</span><span style="color:#a90d91">sql</span> <span style="color:#000">=</span> <span style="color:#c41a16">&#39;select * from test2 where id = 1 || 1 = 1&#39;</span>;</code></pre></div>
<p>提供占位符的形式:</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-PHP" data-lang="PHP">$sql = &#39;select * from test2 where id = :id&#39;;
$result =  Test2::findBySql($sql,array(&#39;:id&#39; =&gt; 1 )) -&gt; all();
print_r($result);</code></pre></div>
<p>运行时会将占位符看成一个整体。</p>

<p>此外提供了更优雅的方式:</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-PHP" data-lang="PHP">$result =  Test2::find()-&gt;where([&#39;id&#39; =&gt; 2]) -&gt; all();
print_r($result);</code></pre></div>
<p>&gt;</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-PHP" data-lang="PHP">$result =  Test2::find()-&gt;where([&#39;&gt;&#39;,&#39;id&#39;, &#39;1&#39;]) -&gt; all();
print_r($result);</code></pre></div>
<p>between</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-PHP" data-lang="PHP">$result =  Test2::find()-&gt;where([&#39;between&#39;,&#39;id&#39;, 1,2]) -&gt; all();
print_r($result);</code></pre></div>
<p>like</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-PHP" data-lang="PHP">$result =  Test2::find()-&gt;where([&#39;like&#39;,&#39;title&#39;,&#34;小明&#34;]) -&gt; all();
print_r($result);</code></pre></div>
<h3 id="查询优化">查询优化</h3>

<p>将查询结果(对象)转换为数组:</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-PHP" data-lang="PHP">$result =  Test2::find()-&gt;where([&#39;like&#39;,&#39;title&#39;,&#34;小明&#34;])-&gt; asArray() -&gt; all();
print_r($result);

//查询结果
Array
(
    [0] =&gt; Array
        (
            [id] =&gt; 1
            [title] =&gt; 小明
        )
)</code></pre></div>
<p>批量查询: 分批</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-PHP" data-lang="PHP">//配合foreach
foreach (Test2::find() -&gt; batch(1) as $tests){
  print_r($tests);
}</code></pre></div>
<h3 id="删除">删除</h3>

<p>删除一条:</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-PHP" data-lang="PHP">$result = Test2::find() -&gt; where([&#39;id&#39; =&gt; 1]) -&gt; all();
$result[0] -&gt; delete();</code></pre></div>
<p>删除多条:</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-PHP" data-lang="PHP">Test2::deleteAll(&#39;id&gt;:id&#39;,array(&#39;:id&#39;=&gt;0));</code></pre></div>
<h3 id="添加">添加</h3>

<p>使用<code>save()</code>方法:</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-PHP" data-lang="PHP">//添加数据
$test = new Test2();
$test -&gt; title = &#34;小黑&#34;;
$test -&gt; save();</code></pre></div>
<p>model中的验证举例:</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-PHP" data-lang="PHP">public  function rules()
{
   return [
       [&#39;title&#39;,&#39;string&#39;,&#39;length&#39;=&gt; [0,5]]
   ];
}</code></pre></div>
<p>进行验证:</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-PHP" data-lang="PHP">//添加数据
$test = new Test2();
$test -&gt; title = &#34;小黑小黑小黑&#34;;

$test -&gt; validate();
if ($test -&gt; hasErrors()){
  echo &#39;data is error&#39;;
  die;
}
$test -&gt; save();</code></pre></div>
<h3 id="数据修改">数据修改</h3>

<p>修改,然后使用save保存</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-PHP" data-lang="PHP">$test = Test2::find()-&gt;where([&#39;id&#39; =&gt; 4]) -&gt; one();
$test-&gt;title = &#39;t4&#39;;
$test-&gt;save();</code></pre></div>
<h3 id="关联查询">关联查询</h3>

<p>测试数据:</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-msql" data-lang="msql">mysql&gt; create table customer ( 
    -&gt; id int auto_increment primary key ,
    -&gt; name varchar(20)
    -&gt; ) CHARSET=utf8;    
mysql&gt; create table myorder( id int auto_increment primary key , customer_id int , price int);
Query OK, 0 rows affected (0.01 sec) 

mysql&gt; select * from customer;
+----+--------+
| id | name   |
+----+--------+
|  1 | 小明   |
|  2 | 小白   |
+----+--------+
2 rows in set (0.00 sec)

mysql&gt; insert into myorder(customer_id,price) values(&#39;1&#39;, 20);
Query OK, 1 row affected (0.01 sec)

mysql&gt; insert into myorder(customer_id,price) values(&#39;2&#39;, 120);
Query OK, 1 row affected (0.00 sec)

mysql&gt; select * from myorder;
+----+-------------+-------+
| id | customer_id | price |
+----+-------------+-------+
|  1 |           1 |    20 |
|  2 |           2 |   120 |
+----+-------------+-------+
2 rows in set (0.00 sec)   </code></pre></div>
<p>order模型:</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-PHP" data-lang="PHP">namespace app\models;
use yii\db\ActiveRecord;
class Order extends ActiveRecord
{
    public static function tableName()
    {
        return &#34;myorder&#34;;
    }
}</code></pre></div>
<p>关联查询</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-PHP" data-lang="PHP">//关联查询  根据顾客查询订单信息
$customer = Customer::find()-&gt;where([&#39;name&#39; =&gt; &#39;小明&#39;]) -&gt; one();
//关联查询的方法
$order = $customer-&gt;hasMany(&#39;app\models\Order&#39;,[&#39;customer_id&#39; =&gt; &#39;id&#39;]) -&gt; all();
print_r($order);</code></pre></div>
<p>也可以使用静态方法获取类名:</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-PHP" data-lang="PHP">$order = $customer-&gt;hasMany(Order::className(),[&#39;customer_id&#39; =&gt; &#39;id&#39;]) -&gt; all();</code></pre></div>
<p>将查询的代码封装到<code>Customer</code>类中:</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-PHP" data-lang="PHP"><span style="color:#633820">&lt;?php</span>
<span style="color:#a90d91">namespace</span> <span style="color:#000">app\models</span>;
<span style="color:#a90d91">use</span> <span style="color:#000">yii\db\ActiveRecord</span>;

<span style="color:#a90d91">class</span> <span style="color:#3f6e75">Customer</span> <span style="color:#a90d91">extends</span> <span style="color:#000">ActiveRecord</span>
{
        <span style="color:#177500">//顾客获取订单信息
</span><span style="color:#177500"></span>    <span style="color:#a90d91">public</span> <span style="color:#a90d91">function</span> <span style="color:#000">getOrders</span>(){

        <span style="color:#177500">//关联查询  根据顾客查询订单信息
</span><span style="color:#177500"></span>        <span style="color:#177500">//$customer = Customer::find()-&gt;where([&#39;name&#39; =&gt; &#39;小明&#39;]) -&gt; one();
</span><span style="color:#177500"></span>        <span style="color:#177500">//关联查询的方法
</span><span style="color:#177500"></span>        <span style="color:#177500">//$order = $customer-&gt;hasMany(&#39;app\models\Order&#39;,[&#39;customer_id&#39; =&gt; &#39;id&#39;]) -&gt; all();
</span><span style="color:#177500"></span>        <span style="color:#000">$order</span> <span style="color:#000">=</span> <span style="color:#000">$this</span><span style="color:#000">-&gt;</span><span style="color:#836c28">hasMany</span>(<span style="color:#000">Order</span><span style="color:#000">::</span><span style="color:#836c28">className</span>(),[<span style="color:#c41a16">&#39;customer_id&#39;</span> <span style="color:#000">=&gt;</span> <span style="color:#c41a16">&#39;id&#39;</span>]) <span style="color:#000">-&gt;</span> <span style="color:#836c28">asArray</span>() ; <span style="color:#177500">//-&gt;all();
</span><span style="color:#177500"></span>
        <span style="color:#177500">//print_r($customer-&gt;getOrders());
</span><span style="color:#177500"></span>        <span style="color:#177500">//如果要使用
</span><span style="color:#177500"></span>        <span style="color:#177500">//print_r($customer-&gt;orders);
</span><span style="color:#177500"></span>        <span style="color:#177500">//访问不存在的属性时,会访问`__get()`方法,自动调用get方法,自动补上-&gt;all()方法
</span><span style="color:#177500"></span>        <span style="color:#177500">//会冲突,因此去掉 -&gt; all(),使用 -&gt;orders返回同样结果
</span><span style="color:#177500"></span>      <span style="color:#a90d91">return</span> <span style="color:#000">$order</span>;
    }
}
</code></pre></div>
<p>根据订单查询用户(hasOne查询单个):</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-PHP" data-lang="PHP">namespace app\models;
use yii\db\ActiveRecord;

class Order extends ActiveRecord
{
    public function  getCustomer(){
        //一个订单对应一个顾客
        return $this -&gt; hasOne(Customer::className(),[&#39;id&#39; =&gt; &#39;customer_id&#39;]);
    }
    public static function tableName()
    {
        return &#34;myorder&#34;;
    }
}

/**使用
        $order = Order::find() -&gt; where([&#39;id&#39; =&gt; 1]) -&gt; one();
        $res = $order -&gt; customer;
        print_r($res);
*/</code></pre></div>
<h3 id="关联查询注意点">关联查询注意点</h3>

<p>1). 关联查询的结果缓存可以通过unset清除</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-PHP" data-lang="PHP">$order = Order::find() -&gt; where([&#39;id&#39; =&gt; 1]) -&gt; one();
$res1 = $order -&gt; customer;
unset($order -&gt; customer);
$res2 = $order -&gt; customer; //重新执行了 select * from ....</code></pre></div>
<p>2). 关联查询的多次查询</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-PHP" data-lang="PHP">//查询全部用户
$customer::find() -&gt; all();
foreach ($customers as $customer){
    //查询每个用户的订单信息
    $orders = $customer -&gt; orders;
}</code></pre></div>
<p>如果有100个用户会执行sql （1+100) 次。</p>

<p>优化:</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-PHP" data-lang="PHP">$customers = Customer::find()-&gt;with(&#39;orders&#39;) -&gt; all();</code></pre></div>
<p>给用户的orders属性填上值
执行了<code>select * from a where id in (select id from b );</code>:</p>

<p>select * from customer ;
select * from order where customer_id in(&hellip;)</p>

<p>参考: <a href="http://www.cnblogs.com/beijingstruggle/p/5885137.html">http://www.cnblogs.com/beijingstruggle/p/5885137.html</a></p>
</div><div id="sidebar" class="column col-2 col-md-12">
                    <div id='toc' class="sidebar-content toc-fixed"><nav id="TableOfContents">
<ul>
<li>
<ul>
<li><a href="#配置">配置</a></li>
<li><a href="#请求处理流程">请求处理流程</a></li>
<li><a href="#控制器controller创建">控制器Controller创建</a>
<ul>
<li><a href="#创建">创建</a></li>
<li><a href="#获取请求参数等">获取请求参数等</a></li>
<li><a href="#响应处理">响应处理</a></li>
<li><a href="#返回状态码">返回状态码:</a></li>
<li><a href="#可以设置响应头">可以设置响应头:</a></li>
<li><a href="#重定向">重定向</a></li>
<li><a href="#文件下载">文件下载</a></li>
<li><a href="#session">session</a></li>
<li><a href="#cookie">cookie</a></li>
</ul></li>
<li><a href="#视图的创建">视图的创建</a>
<ul>
<li><a href="#renderpartial">renderPartial</a></li>
<li><a href="#传递字典或数组参数">传递字典或数组参数</a></li>
<li><a href="#视图的数组安全">视图的数组安全</a></li>
<li><a href="#布局文件">布局文件</a></li>
<li><a href="#视图中显示其他视图-视图组件">视图中显示其他视图（视图组件）</a></li>
<li><a href="#视图之数据块">视图之数据块</a></li>
</ul></li>
<li><a href="#数据模型">数据模型</a>
<ul>
<li><a href="#数据库配置">数据库配置</a></li>
<li><a href="#数据模型之活动记录的创建">数据模型之活动记录的创建</a></li>
<li><a href="#防止sql注入">防止sql注入</a></li>
<li><a href="#查询优化">查询优化</a></li>
<li><a href="#删除">删除</a></li>
<li><a href="#添加">添加</a></li>
<li><a href="#数据修改">数据修改</a></li>
<li><a href="#关联查询">关联查询</a></li>
<li><a href="#关联查询注意点">关联查询注意点</a></li>
</ul></li>
</ul></li>
</ul>
</nav></div>
                    <script src="https://quicktouch.github.io/js/toc.js"></script>
                </div></div>
        </section>
    </section>
</section>
    </div>

             
    <section id="footer" class="section bg-gray">
        <section class="container">
            <p><a href="/">© 2019 </a> <i class="fa fa-code"></i> with <i
                    class="fa fa-heart-o pulse "></i> by <a href="/">hugo</a>.</p>
        </section>
    </section>
    
    <div class="mobile-container">
        <div class="overlay" id="overlay">
            <div class="mobile-logo"><a href="https://quicktouch.github.io" class="navbar-brand mr-10">
    
    

    <svg height="146px" viewBox="0 0 452 146" version="1.1" xmlns="http://www.w3.org/2000/svg"
        xmlns:xlink="http://www.w3.org/1999/xlink">
        <g id="页面1" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">
            <g id="black-37249" transform="translate(1.493827, 14.000000)" fill="#000000" fill-rule="nonzero">
                <path
                    d="M49.1575565,105.3356 C58.6514419,107.744266 56.8866035,117.059598 47.336582,117.946151 C42.200257,119.088059 32.5122345,116.823453 40.3049269,121.756528 C38.9160522,122.059136 31.4488504,121.215252 34.0530212,124.835545 C49.3931802,133.332539 76.1538235,115.03264 58.9252282,100.789887 C52.729951,96.9744155 44.6696275,99.6170026 49.1574334,105.335227 L49.1575565,105.3356 Z"
                    id="路径"></path>
                <path
                    d="M19.6456893,70.1148 C22.442564,67.6540154 27.5058454,64.8429245 31.2812983,65.0068451 C34.6705665,65.8322497 35.5828047,67.0095653 39.186732,72.7438254 C42.8052895,78.5014146 47.9529463,97.2035504 46.1250646,102.790183 C44.2922642,108.392369 38.9206152,112.836988 32.033488,115.798916 C26.5426541,118.077388 16.2140442,117.216187 11.6635736,112.33745 C7.2203064,106.943992 10.4439768,99.2077518 14.1196674,94.0765913 C17.8286541,88.8988961 15.684207,74.5702816 19.6458155,70.1143062 L19.6456893,70.1148 Z"
                    id="路径"></path>
                <path
                    d="M1.04535518,39.6272974 C4.05921119,39.3911165 4.59137567,39.1071824 5.59060008,38.0238167 C6.58982449,36.9404509 5.54928544,35.2576243 6.19663273,34.5114663 C6.84398002,33.7653083 8.10097246,32.9215361 9.07530028,33.5952113 C10.0496281,34.2688865 10.1138613,37.3267543 9.37831661,38.4819379 C8.64277193,39.6371215 5.43905457,40.0090086 5.43905457,40.0090086 L-0.469776243,41.8414683 C-1.16205066,72.2197737 13.1673278,72.6175072 32.5592772,62.9150689 C34.2888429,65.128073 36.8652659,66.7978007 39.3430985,68.5308898 C41.0289707,68.9713953 42.7656319,69.3673848 46.0436407,68.4125409 C52.7893702,66.6134557 67.7858277,37.9865577 58.6189054,24.5853236 C59.5609921,22.3072017 58.5329188,17.6980103 54.831139,9.92564579 C51.5837531,14.9810013 48.3835461,17.0014121 44.9911376,18.7424057 C39.7628549,17.4246155 36.1260864,16.8411895 31.0440711,17.2556102 C32.114064,10.6923806 28.9520111,5.60816741 24.8321244,0 C14.7334474,6.21819269 9.90786696,14.7224118 6.65139374,20.7687134 C4.38306595,26.7113784 -1.96157957,39.8636841 1.04555436,39.6278043 L1.04535518,39.6272974 Z"
                    id="路径"></path>
            </g>
            <text id="TYRAD" font-family="STBaoliSC-Regular, Baoli SC" font-size="116" font-weight="normal"
                fill="#000000">
                <tspan x="87" y="106">TYRAD</tspan>
            </text>
        </g>
    </svg>

    
    

    
</a></div>
            <nav class="overlay-menu">

<ul class=" tree treemenu treemenu-root "><li>
        <a href="/" title="Home page"
            class="">Home</a>
    </li><li>
        <a href="/archives/" title="Archives page"
            class="">Archives</a>
    </li><li>
        <a href="/wiki/" title="Wiki page"
            class="">Wiki</a>
    </li><li>
        <a href="/tools/" title="Tools page"
            class="">Tools</a>
        <ul><li>
                <a href="/tools/json/" class="">JSON解析</a>
            </li><li>
                <a href="/tools/rsa/" class="">RSA测试</a>
            </li><li>
                <a href="/tools/knowlegenav/" class="">导航</a>
            </li></ul>
    </li><li>
        <a href="/about/" title="About page"
            class="">About</a>
    </li></ul></nav>
        </div>
    </div>
    <script src="https://quicktouch.github.io/js/jquery-2.x.min.js"></script>
    <script src="https://quicktouch.github.io/js/jquery.treemenu.js"></script>
    <script src="https://quicktouch.github.io/js/site.js"></script>
    <script src="https://quicktouch.github.io/js/baidu.js"></script>
    
</body>

</html>